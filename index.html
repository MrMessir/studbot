<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Helper</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: #f8f9fa;
            color: #1a1a1a;
            padding-bottom: 80px;
        }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .nav-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
            border-top: 1px solid #e9ecef;
            z-index: 100;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            color: #868e96;
            font-size: 12px;
            cursor: pointer;
            transition: 0.2s;
        }

        .nav-item.active {
            color: #0d6efd;
        }

        .nav-icon {
            font-size: 24px;
        }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü */
        .page {
            display: none;
            padding: 20px;
            min-height: 100vh;
        }

        .page.active {
            display: block;
        }

        /* –ó–∞–≥–æ–ª–æ–≤–∫–∏ */
        h1 {
            font-size: 28px;
            margin-bottom: 20px;
            color: #212529;
        }

        h2 {
            font-size: 18px;
            margin: 20px 0 12px;
            color: #495057;
        }

        h3 {
            font-size: 16px;
            margin-bottom: 8px;
            color: #495057;
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ */
        .card {
            background: white;
            border-radius: 16px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            margin-bottom: 16px;
        }

        /* –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä */
        .progress-section {
            text-align: center;
            margin: 20px 0;
        }

        .progress-ring {
            width: 120px;
            height: 120px;
            margin: 0 auto 16px;
        }

        .week-stats {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 600;
            color: #0d6efd;
        }

        .stat-label {
            font-size: 12px;
            color: #868e96;
        }

        /* –ö–∞–ª–µ–Ω–¥–∞—Ä—å */
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .calendar-month {
            font-size: 18px;
            font-weight: 600;
        }

        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            text-align: center;
            font-size: 12px;
            color: #868e96;
            margin-bottom: 8px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            border-radius: 8px;
            cursor: pointer;
            background: #f8f9fa;
        }

        .calendar-day.has-lessons {
            background: #cfe2ff;
            color: #0d6efd;
            font-weight: 600;
        }

        .calendar-day.today {
            border: 2px solid #0d6efd;
        }

        .calendar-day.selected {
            background: #0d6efd;
            color: white;
        }

        /* –°–ø–∏—Å–æ–∫ –ø–∞—Ä */
        .lesson-item {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .lesson-item:last-child {
            border-bottom: none;
        }

        .lesson-time {
            font-weight: 600;
            color: #0d6efd;
            width: 70px;
            font-size: 14px;
        }

        .lesson-info {
            flex: 1;
        }

        .lesson-subject {
            font-weight: 500;
            margin-bottom: 4px;
        }

        .lesson-details {
            font-size: 12px;
            color: #868e96;
        }

        .add-lesson-btn {
            width: 100%;
            padding: 12px;
            background: #e7f5ff;
            border: 1px dashed #0d6efd;
            border-radius: 12px;
            color: #0d6efd;
            font-size: 14px;
            cursor: pointer;
            margin-top: 12px;
        }

        /* –ó–∞–¥–∞—á–∏ */
        .filters {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .filter-chip {
            padding: 8px 16px;
            background: #f1f3f5;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
        }

        .filter-chip.active {
            background: #0d6efd;
            color: white;
        }

        .task-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 12px;
            margin-bottom: 8px;
        }

        .task-checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid #ced4da;
            border-radius: 6px;
            margin-right: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .task-checkbox.checked {
            background: #0d6efd;
            border-color: #0d6efd;
            color: white;
        }

        .task-content {
            flex: 1;
        }

        .task-title {
            font-weight: 500;
            margin-bottom: 4px;
        }

        .task-meta {
            font-size: 12px;
            color: #868e96;
            display: flex;
            gap: 12px;
        }

        .priority-high { color: #dc3545; }
        .priority-medium { color: #fd7e14; }
        .priority-low { color: #20c997; }

        /* –ü—Ä–æ—Ñ–∏–ª—å */
        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            background: #0d6efd;
            border-radius: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 36px;
        }

        .profile-info h2 {
            margin: 0 0 4px;
        }

        .profile-info p {
            color: #868e96;
            font-size: 14px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 20px 0;
        }

        .stat-card {
            background: #f8f9fa;
            padding: 16px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-number {
            font-size: 28px;
            font-weight: 600;
            color: #0d6efd;
        }

        .achievement-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin: 20px 0;
        }

        .achievement {
            text-align: center;
        }

        .achievement-icon {
            width: 60px;
            height: 60px;
            background: #fff3bf;
            border-radius: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 8px;
            font-size: 30px;
        }

        .settings-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .settings-item:last-child {
            border-bottom: none;
        }

        /* –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å */
        .switch {
            position: relative;
            display: inline-block;
            width: 52px;
            height: 26px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .3s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .3s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #0d6efd;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* –ö–Ω–æ–ø–∫–∏ */
        .button {
            padding: 14px;
            background: #0d6efd;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            width: 100%;
        }

        .button-outline {
            background: white;
            border: 1px solid #0d6efd;
            color: #0d6efd;
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 24px;
            width: 90%;
            max-width: 400px;
        }

        .modal input, .modal select {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border: 1px solid #ced4da;
            border-radius: 8px;
            font-size: 16px;
        }

        .modal-buttons {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ 1: –ì–ª–∞–≤–Ω–∞—è -->
    <div class="page active" id="page1">
        <h1>üè† –ì–ª–∞–≤–Ω–∞—è</h1>
        
        <div class="card">
            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                <div style="width: 50px; height: 50px; background: #0d6efd; border-radius: 25px; display: flex; align-items: center; justify-content: center; color: white; font-size: 24px;">
                    üëã
                </div>
                <div>
                    <h2 id="greeting">–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ, –°—Ç—É–¥–µ–Ω—Ç!</h2>
                    <p id="dateToday" style="color: #868e96;"></p>
                </div>
            </div>
        </div>

        <div class="card">
            <h3>üìä –ü—Ä–æ–≥—Ä–µ—Å—Å –Ω–µ–¥–µ–ª–∏</h3>
            <div class="progress-section">
                <div class="progress-ring">
                    <svg width="120" height="120" viewBox="0 0 120 120">
                        <circle cx="60" cy="60" r="54" fill="none" stroke="#e9ecef" stroke-width="8"/>
                        <circle id="progressCircle" cx="60" cy="60" r="54" fill="none" stroke="#0d6efd" stroke-width="8" 
                                stroke-dasharray="339.292" stroke-dashoffset="339.292" transform="rotate(-90 60 60)"/>
                    </svg>
                </div>
                <div style="font-size: 24px; font-weight: 600;" id="progressPercent">0%</div>
            </div>
            
            <div class="week-stats">
                <div class="stat-item">
                    <div class="stat-value" id="lessonsDone">0</div>
                    <div class="stat-label">–ü–∞—Ä</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="tasksDone">0</div>
                    <div class="stat-label">–ó–∞–¥–∞—á</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="daysLeft">0</div>
                    <div class="stat-label">–î–Ω–µ–π</div>
                </div>
            </div>
        </div>

        <div class="card">
            <h3>üìÖ –°–µ–≥–æ–¥–Ω—è</h3>
            <div id="todaySummary">
                <p style="color: #868e96; text-align: center;">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
            </div>
        </div>
    </div>

    <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ 2: –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ -->
    <div class="page" id="page2">
        <h1>üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</h1>
        
        <div class="card">
            <div class="calendar-header">
                <button class="nav-icon" onclick="changeMonth(-1)">‚Üê</button>
                <span class="calendar-month" id="currentMonth">–î–µ–∫–∞–±—Ä—å 2024</span>
                <button class="nav-icon" onclick="changeMonth(1)">‚Üí</button>
            </div>
            
            <div class="calendar-weekdays">
                <div>–ü–Ω</div>
                <div>–í—Ç</div>
                <div>–°—Ä</div>
                <div>–ß—Ç</div>
                <div>–ü—Ç</div>
                <div>–°–±</div>
                <div>–í—Å</div>
            </div>
            
            <div class="calendar-grid" id="calendar"></div>
        </div>

        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <h3>–ü–∞—Ä—ã –Ω–∞ <span id="selectedDate">—Å–µ–≥–æ–¥–Ω—è</span></h3>
                <span class="nav-icon" onclick="showAddLessonModal()">‚ûï</span>
            </div>
            <div id="lessonsList"></div>
            <button class="add-lesson-btn" onclick="showAddLessonModal()">
                + –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä—É
            </button>
        </div>
    </div>

    <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ 3: –ó–∞–¥–∞—á–∏ -->
    <div class="page" id="page3">
        <h1>üìù –ó–∞–¥–∞—á–∏</h1>
        
        <div class="filters">
            <div class="filter-chip active" onclick="filterTasks('all')">–í—Å–µ</div>
            <div class="filter-chip" onclick="filterTasks('math')">–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞</div>
            <div class="filter-chip" onclick="filterTasks('physics')">–§–∏–∑–∏–∫–∞</div>
            <div class="filter-chip" onclick="filterTasks('programming')">–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ</div>
        </div>

        <div class="card">
            <div id="tasksList"></div>
            <button class="add-lesson-btn" onclick="showAddTaskModal()">
                + –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É
            </button>
        </div>
    </div>

    <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ 4: –ü—Ä–æ—Ñ–∏–ª—å -->
    <div class="page" id="page4">
        <h1>üë§ –ü—Ä–æ—Ñ–∏–ª—å</h1>
        
        <div class="card">
            <div class="profile-header">
                <div class="profile-avatar" id="userAvatar">üéì</div>
                <div class="profile-info">
                    <h2 id="userName">–°—Ç—É–¥–µ–Ω—Ç</h2>
                    <p id="userGroup">–ì—Ä—É–ø–ø–∞: –ò–£–ö1-11–ë</p>
                    <p id="userSince">–° –Ω–∞–º–∏ —Å: –î–µ–∫ 2024</p>
                </div>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="statPairs">0</div>
                <div>–ü–∞—Ä</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="statTasks">0</div>
                <div>–ó–∞–¥–∞—á</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="statNotes">0</div>
                <div>–ó–∞–º–µ—Ç–æ–∫</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="statDays">0</div>
                <div>–î–Ω–µ–π</div>
            </div>
        </div>

        <div class="card">
            <h3>üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h3>
            <div class="achievement-grid" id="achievements"></div>
        </div>

        <div class="card">
            <h3>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
            
            <div class="settings-item">
                <span>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</span>
                <label class="switch">
                    <input type="checkbox" id="notifications" checked onchange="toggleSetting('notifications')">
                    <span class="slider"></span>
                </label>
            </div>
            
            <div class="settings-item">
                <span>–¢–µ–º–Ω–∞—è —Ç–µ–º–∞</span>
                <label class="switch">
                    <input type="checkbox" id="darkTheme" onchange="toggleSetting('darkTheme')">
                    <span class="slider"></span>
                </label>
            </div>
            
            <div class="settings-item">
                <span>–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –ø–∞—Ä–∞—Ö</span>
                <label class="switch">
                    <input type="checkbox" id="lessonReminders" checked onchange="toggleSetting('lessonReminders')">
                    <span class="slider"></span>
                </label>
            </div>
        </div>
    </div>

    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <div class="nav-bar">
        <div class="nav-item active" onclick="switchPage(1)">
            <span class="nav-icon">üè†</span>
            <span>–ì–ª–∞–≤–Ω–∞—è</span>
        </div>
        <div class="nav-item" onclick="switchPage(2)">
            <span class="nav-icon">üìÖ</span>
            <span>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</span>
        </div>
        <div class="nav-item" onclick="switchPage(3)">
            <span class="nav-icon">üìù</span>
            <span>–ó–∞–¥–∞—á–∏</span>
        </div>
        <div class="nav-item" onclick="switchPage(4)">
            <span class="nav-icon">üë§</span>
            <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–∞—Ä—ã -->
    <div class="modal" id="addLessonModal">
        <div class="modal-content">
            <h3>‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä—É</h3>
            <input type="text" id="lessonSubject" placeholder="–ü—Ä–µ–¥–º–µ—Ç" required>
            <input type="time" id="lessonTime" required>
            <input type="text" id="lessonRoom" placeholder="–ê—É–¥–∏—Ç–æ—Ä–∏—è" required>
            <input type="text" id="lessonTeacher" placeholder="–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å" required>
            
            <div class="modal-buttons">
                <button class="button" onclick="addLesson()">–î–æ–±–∞–≤–∏—Ç—å</button>
                <button class="button button-outline" onclick="closeModal('addLessonModal')">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ -->
    <div class="modal" id="addTaskModal">
        <div class="modal-content">
            <h3>‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É</h3>
            <input type="text" id="taskSubject" placeholder="–ü—Ä–µ–¥–º–µ—Ç" required>
            <input type="text" id="taskDescription" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" required>
            <input type="date" id="taskDeadline" required>
            <select id="taskPriority">
                <option value="high">üî¥ –í—ã—Å–æ–∫–∏–π</option>
                <option value="medium">üü° –°—Ä–µ–¥–Ω–∏–π</option>
                <option value="low">üü¢ –ù–∏–∑–∫–∏–π</option>
            </select>
            
            <div class="modal-buttons">
                <button class="button" onclick="addTask()">–î–æ–±–∞–≤–∏—Ç—å</button>
                <button class="button button-outline" onclick="closeModal('addTaskModal')">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();

        // –î–∞–Ω–Ω—ã–µ (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –ø–æ–ª—É—á–∞—Ç—å –æ—Ç –±–æ—Ç–∞)
        let userData = {
            name: '–ê–ª–µ–∫—Å–µ–π',
            group: '–ò–£–ö1-11–ë',
            registeredAt: '2024-12-01',
            stats: {
                pairs: 24,
                tasks: 18,
                notes: 7,
                days: 21
            },
            settings: {
                notifications: true,
                darkTheme: false,
                lessonReminders: true
            }
        };

        let lessons = [
            { date: '2024-12-16', time: '10:00', subject: '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', room: '301', teacher: '–ò–≤–∞–Ω–æ–≤ –ò.–ò.' },
            { date: '2024-12-16', time: '12:00', subject: '–§–∏–∑–∏–∫–∞', room: '205', teacher: '–ü–µ—Ç—Ä–æ–≤ –ü.–ü.' },
            { date: '2024-12-17', time: '09:00', subject: '–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ', room: '410', teacher: '–°–∏–¥–æ—Ä–æ–≤ –°.–°.' },
            { date: '2024-12-18', time: '11:00', subject: '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π', room: '115', teacher: '–°–º–∏—Ä–Ω–æ–≤–∞ –ï.–ê.' }
        ];

        let tasks = [
            { id: 1, subject: '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', description: '–†–µ—à–∏—Ç—å –∑–∞–¥–∞—á–∏ 1-10', deadline: '2024-12-20', priority: 'high', completed: false },
            { id: 2, subject: '–§–∏–∑–∏–∫–∞', description: '–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞', deadline: '2024-12-22', priority: 'medium', completed: false },
            { id: 3, subject: '–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ', description: '–ö—É—Ä—Å–æ–≤–∞—è —Ä–∞–±–æ—Ç–∞', deadline: '2024-12-25', priority: 'high', completed: false },
            { id: 4, subject: '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', description: '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —ç–∫–∑–∞–º–µ–Ω—É', deadline: '2024-12-28', priority: 'low', completed: true }
        ];

        let achievements = [
            { id: 1, icon: 'üìö', name: '–ü–µ—Ä–≤–∞—è –ø–∞—Ä–∞', description: '–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–≤–∞—è –ø–∞—Ä–∞' },
            { id: 2, icon: '‚úÖ', name: '5 –∑–∞–¥–∞—á', description: '–í—ã–ø–æ–ª–Ω–µ–Ω–æ 5 –∑–∞–¥–∞—á' },
            { id: 3, icon: 'üî•', name: '–ù–µ–¥–µ–ª—è', description: '7 –¥–Ω–µ–π –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏' },
            { id: 4, icon: 'üìù', name: '–ó–∞–º–µ—Ç–∫–∏', description: '–°–æ–∑–¥–∞–Ω–æ 10 –∑–∞–º–µ—Ç–æ–∫' },
            { id: 5, icon: 'üéØ', name: '–¶–µ–ª—å', description: '–î–æ—Å—Ç–∏–≥–Ω—É—Ç —É—Ä–æ–≤–µ–Ω—å 5' },
            { id: 6, icon: 'üèÜ', name: '–≠–∫—Å–ø–µ—Ä—Ç', description: '–í—Å–µ –¥–µ–¥–ª–∞–π–Ω—ã –≤–æ–≤—Ä–µ–º—è' }
        ];

        let currentMonth = new Date();
        let selectedDate = new Date().toISOString().split('T')[0];

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü
        function switchPage(pageNum) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(`page${pageNum}`).classList.add('active');
            
            document.querySelectorAll('.nav-item').forEach((item, index) => {
                if (index === pageNum - 1) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });

            if (pageNum === 1) updateHomePage();
            if (pageNum === 2) updateCalendar();
            if (pageNum === 3) updateTasksList();
            if (pageNum === 4) updateProfile();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        function updateHomePage() {
            const now = new Date();
            const hours = now.getHours();
            let greeting = '';
            
            if (hours < 12) greeting = '–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ';
            else if (hours < 18) greeting = '–î–æ–±—Ä—ã–π –¥–µ–Ω—å';
            else greeting = '–î–æ–±—Ä—ã–π –≤–µ—á–µ—Ä';
            
            document.getElementById('greeting').innerHTML = `${greeting}, ${userData.name}! üëã`;
            document.getElementById('dateToday').innerHTML = now.toLocaleDateString('ru-RU', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });

            // –ü—Ä–æ–≥—Ä–µ—Å—Å –Ω–µ–¥–µ–ª–∏
            const weekProgress = calculateWeekProgress();
            document.getElementById('progressPercent').innerHTML = weekProgress.percent + '%';
            
            const circle = document.getElementById('progressCircle');
            const circumference = 2 * Math.PI * 54;
            const offset = circumference - (weekProgress.percent / 100) * circumference;
            circle.style.strokeDashoffset = offset;

            document.getElementById('lessonsDone').innerHTML = weekProgress.lessonsDone;
            document.getElementById('tasksDone').innerHTML = weekProgress.tasksDone;
            document.getElementById('daysLeft').innerHTML = weekProgress.daysLeft;

            // –°–µ–≥–æ–¥–Ω—è—à–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è
            const todayStr = now.toISOString().split('T')[0];
            const todayLessons = lessons.filter(l => l.date === todayStr);
            const todayTasks = tasks.filter(t => t.deadline === todayStr && !t.completed);

            let summary = '';
            if (todayLessons.length === 0 && todayTasks.length === 0) {
                summary = '<p style="color: #868e96; text-align: center;">–°–µ–≥–æ–¥–Ω—è –Ω–∏—á–µ–≥–æ –Ω–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ üéâ</p>';
            } else {
                if (todayLessons.length > 0) {
                    summary += `<p><strong>üìÖ –ü–∞—Ä:</strong> ${todayLessons.length}</p>`;
                }
                if (todayTasks.length > 0) {
                    summary += `<p><strong>üìù –î–µ–¥–ª–∞–π–Ω–æ–≤:</strong> ${todayTasks.length}</p>`;
                }
            }
            document.getElementById('todaySummary').innerHTML = summary;
        }

        // –†–∞—Å—á–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –Ω–µ–¥–µ–ª–∏
        function calculateWeekProgress() {
            const now = new Date();
            const startOfWeek = new Date(now);
            startOfWeek.setDate(now.getDate() - now.getDay() + 1);
            const endOfWeek = new Date(startOfWeek);
            endOfWeek.setDate(startOfWeek.getDate() + 6);

            const weekLessons = lessons.filter(l => {
                const d = new Date(l.date);
                return d >= startOfWeek && d <= endOfWeek;
            });

            const weekTasks = tasks.filter(t => {
                const d = new Date(t.deadline);
                return d >= startOfWeek && d <= endOfWeek;
            });

            const dayOfWeek = now.getDay() || 7;
            const percent = Math.round((dayOfWeek / 7) * 100);

            return {
                percent: percent,
                lessonsDone: weekLessons.length,
                tasksDone: weekTasks.filter(t => t.completed).length,
                daysLeft: 7 - dayOfWeek
            };
        }

        // –ö–∞–ª–µ–Ω–¥–∞—Ä—å
        function updateCalendar() {
            const year = currentMonth.getFullYear();
            const month = currentMonth.getMonth();
            
            document.getElementById('currentMonth').innerHTML = 
                currentMonth.toLocaleDateString('ru-RU', { month: 'long', year: 'numeric' });

            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            
            let calendarHTML = '';
            
            // –ü—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏ –¥–æ –ø–µ—Ä–≤–æ–≥–æ –¥–Ω—è
            for (let i = 0; i < (firstDay.getDay() || 7) - 1; i++) {
                calendarHTML += '<div class="calendar-day"></div>';
            }
            
            // –î–Ω–∏ –º–µ—Å—è—Ü–∞
            for (let d = 1; d <= lastDay.getDate(); d++) {
                const date = new Date(year, month, d);
                const dateStr = date.toISOString().split('T')[0];
                const hasLessons = lessons.some(l => l.date === dateStr);
                const isToday = dateStr === new Date().toISOString().split('T')[0];
                const isSelected = dateStr === selectedDate;
                
                calendarHTML += `<div class="calendar-day ${hasLessons ? 'has-lessons' : ''} ${isToday ? 'today' : ''} ${isSelected ? 'selected' : ''}" 
                                onclick="selectDate('${dateStr}')">${d}</div>`;
            }
            
            document.getElementById('calendar').innerHTML = calendarHTML;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞—Ä—ã –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –¥–∞—Ç—É
            showLessonsForDate(selectedDate);
        }

        function changeMonth(delta) {
            currentMonth.setMonth(currentMonth.getMonth() + delta);
            updateCalendar();
        }

        function selectDate(dateStr) {
            selectedDate = dateStr;
            updateCalendar();
        }

        function showLessonsForDate(dateStr) {
            const dateLessons = lessons.filter(l => l.date === dateStr);
            const formattedDate = new Date(dateStr).toLocaleDateString('ru-RU', { 
                day: 'numeric', 
                month: 'long' 
            });
            
            document.getElementById('selectedDate').innerHTML = formattedDate;
            
            let lessonsHTML = '';
            if (dateLessons.length === 0) {
                lessonsHTML = '<p style="color: #868e96; text-align: center;">–ü–∞—Ä –Ω–µ—Ç</p>';
            } else {
                dateLessons.sort((a, b) => a.time.localeCompare(b.time));
                dateLessons.forEach(lesson => {
                    lessonsHTML += `
                        <div class="lesson-item">
                            <div class="lesson-time">${lesson.time}</div>
                            <div class="lesson-info">
                                <div class="lesson-subject">${lesson.subject}</div>
                                <div class="lesson-details">${lesson.room} ‚Ä¢ ${lesson.teacher}</div>
                            </div>
                        </div>
                    `;
                });
            }
            
            document.getElementById('lessonsList').innerHTML = lessonsHTML;
        }

        // –ó–∞–¥–∞—á–∏
        function updateTasksList(filter = 'all') {
            let filteredTasks = tasks;
            if (filter !== 'all') {
                filteredTasks = tasks.filter(t => t.subject.toLowerCase().includes(filter));
            }
            
            filteredTasks.sort((a, b) => new Date(a.deadline) - new Date(b.deadline));
            
            let tasksHTML = '';
            filteredTasks.forEach(task => {
                const daysLeft = Math.ceil((new Date(task.deadline) - new Date()) / (1000 * 60 * 60 * 24));
                const priorityClass = `priority-${task.priority}`;
                const priorityEmoji = task.priority === 'high' ? 'üî¥' : task.priority === 'medium' ? 'üü°' : 'üü¢';
                
                tasksHTML += `
                    <div class="task-item">
                        <div class="task-checkbox ${task.completed ? 'checked' : ''}" 
                             onclick="toggleTask(${task.id})">
                            ${task.completed ? '‚úì' : ''}
                        </div>
                        <div class="task-content">
                            <div class="task-title">${task.subject} - ${task.description}</div>
                            <div class="task-meta">
                                <span class="${priorityClass}">${priorityEmoji} ${task.priority}</span>
                                <span>üìÖ –¥–æ ${new Date(task.deadline).toLocaleDateString('ru-RU')}</span>
                                <span>‚è∞ ${daysLeft} –¥–Ω.</span>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('tasksList').innerHTML = tasksHTML;
        }

        function filterTasks(filter) {
            document.querySelectorAll('.filter-chip').forEach(chip => {
                chip.classList.remove('active');
                if (chip.innerText.toLowerCase() === filter || 
                    (filter === 'all' && chip.innerText === '–í—Å–µ')) {
                    chip.classList.add('active');
                }
            });
            updateTasksList(filter);
        }

        function toggleTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                task.completed = !task.completed;
                updateTasksList();
                if (document.querySelector('.nav-item.active').innerText.includes('–ì–ª–∞–≤–Ω–∞—è')) {
                    updateHomePage();
                }
            }
        }

        // –ü—Ä–æ—Ñ–∏–ª—å
        function updateProfile() {
            document.getElementById('userName').innerHTML = userData.name;
            document.getElementById('userGroup').innerHTML = `–ì—Ä—É–ø–ø–∞: ${userData.group}`;
            document.getElementById('userSince').innerHTML = `–° –Ω–∞–º–∏ —Å: ${new Date(userData.registeredAt).toLocaleDateString('ru-RU', { month: 'short', year: 'numeric' })}`;
            
            document.getElementById('statPairs').innerHTML = userData.stats.pairs;
            document.getElementById('statTasks').innerHTML = userData.stats.tasks;
            document.getElementById('statNotes').innerHTML = userData.stats.notes;
            document.getElementById('statDays').innerHTML = userData.stats.days;
            
            let achievementsHTML = '';
            achievements.slice(0, 6).forEach(ach => {
                achievementsHTML += `
                    <div class="achievement">
                        <div class="achievement-icon">${ach.icon}</div>
                        <div style="font-size: 12px;">${ach.name}</div>
                    </div>
                `;
            });
            document.getElementById('achievements').innerHTML = achievementsHTML;
            
            document.getElementById('notifications').checked = userData.settings.notifications;
            document.getElementById('lessonReminders').checked = userData.settings.lessonReminders;
        }

        function toggleSetting(setting) {
            const value = document.getElementById(setting).checked;
            userData.settings[setting] = value;
            
            tg.sendData(JSON.stringify({
                action: 'update_settings',
                setting: setting,
                value: value
            }));
        }

        // –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
        function showAddLessonModal() {
            document.getElementById('addLessonModal').classList.add('active');
        }

        function showAddTaskModal() {
            document.getElementById('addTaskModal').classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function addLesson() {
            const subject = document.getElementById('lessonSubject').value;
            const time = document.getElementById('lessonTime').value;
            const room = document.getElementById('lessonRoom').value;
            const teacher = document.getElementById('lessonTeacher').value;
            
            if (subject && time && room && teacher) {
                const newLesson = {
                    date: selectedDate,
                    time: time,
                    subject: subject,
                    room: room,
                    teacher: teacher
                };
                
                lessons.push(newLesson);
                
                tg.sendData(JSON.stringify({
                    action: 'add_lesson',
                    lesson: newLesson
                }));
                
                closeModal('addLessonModal');
                updateCalendar();
                
                // –û—á–∏—Å—Ç–∏—Ç—å –ø–æ–ª—è
                document.getElementById('lessonSubject').value = '';
                document.getElementById('lessonTime').value = '';
                document.getElementById('lessonRoom').value = '';
                document.getElementById('lessonTeacher').value = '';
            }
        }

        function addTask() {
            const subject = document.getElementById('taskSubject').value;
            const description = document.getElementById('taskDescription').value;
            const deadline = document.getElementById('taskDeadline').value;
            const priority = document.getElementById('taskPriority').value;
            
            if (subject && description && deadline) {
                const newTask = {
                    id: tasks.length + 1,
                    subject: subject,
                    description: description,
                    deadline: deadline,
                    priority: priority,
                    completed: false
                };
                
                tasks.push(newTask);
                
                tg.sendData(JSON.stringify({
                    action: 'add_task',
                    task: newTask
                }));
                
                closeModal('addTaskModal');
                updateTasksList();
                
                // –û—á–∏—Å—Ç–∏—Ç—å –ø–æ–ª—è
                document.getElementById('taskSubject').value = '';
                document.getElementById('taskDescription').value = '';
                document.getElementById('taskDeadline').value = '';
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        window.onload = function() {
            updateHomePage();
            updateCalendar();
            updateTasksList();
            updateProfile();
        };
    </script>
</body>
</html>